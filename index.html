<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puppy Rescue ‚Äì 3D Adventure</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif;}
body{overflow:hidden;transition:background 1s;}

/* HUD */
#hud{display:flex;justify-content:space-around;font-weight:bold;font-size:18px;margin-bottom:5px;}
#lives{color:red;font-weight:bold;}

/* GAME AREA */
#gameArea{
  position:relative;height:520px;width:100%;overflow:hidden;
  perspective:800px;
}

/* WATER */
#water{
  position:absolute;bottom:0;width:100%;height:5%;
  background:linear-gradient(rgba(2,136,209,0.8), rgba(1,87,155,0.8));
  transition:height 1s linear;
  z-index:1;
  border-top-left-radius:20px;
  border-top-right-radius:20px;
}
#water::before{
  content:""; position:absolute; width:200%; height:50%; left:-50%; top:0;
  background:radial-gradient(rgba(255,255,255,0.3) 15%, transparent 70%);
  background-size:50px 50px; animation:wave 4s linear infinite;
}
@keyframes wave{0%{background-position:0 0;}100%{background-position:50px 0;}}

/* PLATFORM 3D */
.platform{
  position:absolute;width:160px;height:20px;
  border-radius:12px;
  background:linear-gradient(#8bc34a,#558b2f);
  box-shadow:0 8px 0 #33691e,inset 0 3px rgba(255,255,255,.4);
  transform-style: preserve-3d;
  transition:top 0.8s ease, left 0.8s ease;
  z-index:2;
}
.platform::after{
  content:""; position:absolute; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.1); border-radius:12px;
}

/* SHAKE */
.shake{animation:shake .4s infinite;}
@keyframes shake{0%{transform:rotate(-1deg)}50%{transform:rotate(1deg)}100%{transform:rotate(-1deg)}}
.fall{top:600px!important;transition:top 2s linear;}

/* PUPPY */
#puppy{
  position:absolute; font-size:50px; z-index:3; text-align:center;
  transition:transform 0.2s;
  text-shadow: 2px 2px 2px rgba(0,0,0,0.3);
}

/* QUESTIONS */
#problem{text-align:center;font-size:17px;margin:8px;min-height:60px;padding:0 12px;}
#tiles{display:flex;justify-content:center;flex-wrap:wrap;}
.tile{
  width:95px;margin:6px;padding:10px;
  background:linear-gradient(#fff176,#fbc02d);
  border-radius:12px;
  box-shadow:0 6px #f57f17;
  font-weight:bold; cursor:pointer;
  text-align:center;
  transition:transform 0.1s, box-shadow 0.1s;
}
.tile:hover{transform:translateY(-3px); box-shadow:0 10px #f57f17;}
.tile:active{transform:translateY(4px); box-shadow:none;}

/* SPLASH / WIN SCREEN */
#splash, #win{
  position:absolute; inset:0; background:rgba(0,0,0,0.7);
  display:none; align-items:center; justify-content:center; flex-direction:column;
  color:white; font-size:30px; z-index:10;
}
#splash button, #win button{
  margin-top:20px;padding:10px 20px;font-size:18px;
  border:none;border-radius:10px;cursor:pointer;background:#ff9800;color:white;
}
</style>
</head>
<body>

<h1>üê∂ Puppy Rescue ‚Äì 3D Adventure</h1>

<div id="hud">
  <div>Level: <span id="level">1</span></div>
  <div>Score: <span id="score">0</span></div>
  <div>Lives: <span id="lives">2</span></div>
  <div>Time: <span id="time">0:00</span></div>
</div>

<div id="problem"></div>
<div id="gameArea">
  <div id="water"></div>
  <div id="puppy">üê∂</div>
</div>
<div id="tiles"></div>

<div id="splash">
  <div id="splash-text"></div>
  <button id="next-level">Next Level</button>
</div>

<div id="win">
  <div>üéâ Puppy rescued through all levels!</div>
</div>

<script>
// ================= GAME DATA =================
const levels = [

  // LEVEL 1 ‚Äì Grammar (Basic Tenses & Prepositions)
  [
   {q:"She ______ to school before it started raining.", a:"walked", o:["walks","walked","walking","has walk"]},
   {q:"The boys hid ______ the table when they heard the loud noise.", a:"under", o:["on","under","above","between"]},
   {q:"Neither of the girls ______ willing to admit the mistake.", a:"was", o:["were","was","are","be"]},
   {q:"The teacher reminded us ______ our homework.", a:"to complete", o:["complete","to complete","completing","completed"]},
   {q:"There are ______ apples left in the basket.", a:"a few", o:["few","a few","little","much"]}
  ],

  // LEVEL 2 ‚Äì Vocabulary (Contextual Meaning)
  [
   {q:"The audience was ______ by the magician‚Äôs performance.", a:"amazed", o:["bored","amazed","tired","annoyed"]},
   {q:"Tim spoke so ______ that nobody could hear him clearly.", a:"softly", o:["loudly","softly","quickly","brightly"]},
   {q:"The principal gave a ______ speech during assembly.", a:"motivational", o:["careless","motivational","broken","angry"]},
   {q:"She looked at the broken vase with a ______ expression.", a:"guilty", o:["proud","guilty","cheerful","excited"]},
   {q:"The firefighter acted ______ to rescue the trapped child.", a:"bravely", o:["lazily","bravely","rudely","quietly"]}
  ],

  // LEVEL 3 ‚Äì Editing for Spelling & Grammar
  [
   {q:"Everyone in the class were excited about the trip.", a:"was", o:["were","is","was","be"]},
   {q:"She has went to the library to return her books.", a:"gone", o:["went","go","gone","going"]},
   {q:"The puppies is playing in the garden.", a:"are", o:["is","was","are","be"]},
   {q:"I prefer reading than watching television.", a:"to", o:["than","to","over","with"]},
   {q:"He did not knew the answer to the question.", a:"know", o:["knew","know","knows","known"]}
  ],

  // LEVEL 4 ‚Äì Sentence Synthesis / Transformation
  [
   {q:"Although it was raining, they continued playing. (Choose correct meaning)", a:"They continued playing despite the rain.", o:["They stopped because of rain.","They continued playing despite the rain.","They waited for rain to stop.","They disliked the rain."]},
   {q:"The cake was so delicious that everyone asked for more. (Closest meaning)", a:"Everyone wanted another slice.", o:["Nobody liked the cake.","Everyone wanted another slice.","The cake was expensive.","The cake was small."]},
   {q:"She was too tired to finish her homework. (Meaning)", a:"She could not finish her homework.", o:["She finished quickly.","She enjoyed homework.","She could not finish her homework.","She started early."]},
   {q:"If you study hard, you will succeed. (Meaning)", a:"Studying hard leads to success.", o:["Success is impossible.","Studying hard leads to success.","Study is unnecessary.","Success comes easily."]},
   {q:"He apologised for breaking the window. (Meaning)", a:"He said sorry for breaking it.", o:["He blamed someone else.","He fixed the window.","He said sorry for breaking it.","He ignored the problem."]}
  ],

  // LEVEL 5 ‚Äì Situational Writing Skills (Tone & Purpose)
  [
   {q:"You are writing to your principal to request permission to hold a charity event. The tone should be:", a:"formal and respectful", o:["casual and funny","formal and respectful","angry","careless"]},
   {q:"When writing an email to a friend about your holiday, the tone should be:", a:"friendly and informal", o:["formal","friendly and informal","strict","serious"]},
   {q:"In a complaint letter, you should include:", a:"clear details of the problem", o:["insults","jokes","clear details of the problem","short unrelated story"]},
   {q:"When ending a formal letter, you should write:", a:"Yours sincerely", o:["Bye","See you","Yours sincerely","Cheers"]},
   {q:"In continuous writing, a good conclusion should:", a:"wrap up the story clearly", o:["introduce new characters","stop suddenly","wrap up the story clearly","repeat the introduction"]}
  ]

];


// ------------------------ GAME LOGIC ------------------------
let levelIndex=0, questionIndex=0, score=0, water=5, seconds=0, lives=2;
const levelColors=["#87ceeb","#1e90ff","#8b4513","#ffc0cb","#0b0b45"];

const puppy=document.getElementById("puppy");
const waterEl=document.getElementById("water");
const gameArea=document.getElementById("gameArea");
const problem=document.getElementById("problem");
const tiles=document.getElementById("tiles");
const scoreEl=document.getElementById("score");
const levelEl=document.getElementById("level");
const livesEl=document.getElementById("lives");
const splash=document.getElementById("splash");
const splashText=document.getElementById("splash-text");
const nextBtn=document.getElementById("next-level");
const winDiv=document.getElementById("win");

let platforms=[];
const baseY=400;
const gap=70;
let timerInterval, waterInterval, platformDropTimeout;

// ===== PLATFORM CREATION
function createPlatforms(num){
  platforms=[];
  document.querySelectorAll(".platform").forEach(p=>p.remove());
  for(let i=0;i<num;i++){
    const p=document.createElement("div");
    p.className="platform";
    let centerX = gameArea.offsetWidth/2;
    let offset = (i%2===0 ? -120 : 120);
    p.style.left = centerX + offset - 80 + "px";
    p.style.top = baseY - i*gap + "px";
    gameArea.appendChild(p);
    platforms.push(p);
  }
}

// ===== PUPPY POSITION
function placePuppy(i){
  const plat=platforms[i];
  puppy.style.left = (plat.offsetLeft + plat.offsetWidth/2 - 25) + "px";
  puppy.style.top = (plat.offsetTop - 50) + "px";
}

// ===== JUMP ANIMATION
function jumpTo(i){
  const startX=parseFloat(puppy.style.left);
  const startY=parseFloat(puppy.style.top);
  const endX = platforms[i].offsetLeft + platforms[i].offsetWidth/2 - 25;
  const endY = platforms[i].offsetTop - 50;
  let t=0;
  function animate(){
    t+=0.05;
    puppy.style.left = startX + (endX-startX)*t + "px";
    puppy.style.top = startY + (endY-startY)*t - Math.sin(t*Math.PI)*50 + "px";
    puppy.style.transform = `scale(${1 + 0.2*Math.sin(t*Math.PI)})`;
    if(t<1) requestAnimationFrame(animate);
  }
  animate();
}

// ===== LOAD QUESTION
function load(){
  const q=levels[levelIndex][questionIndex];
  problem.textContent=q.q;
  tiles.innerHTML="";
  q.o.sort(()=>Math.random()-0.5).forEach(n=>{
    const b=document.createElement("div");
    b.className="tile";
    b.textContent=n;
    b.onclick=()=>check(n);
    tiles.appendChild(b);
  });
}

// ===== CHECK ANSWER
function check(n){
  const q=levels[levelIndex][questionIndex];
  if(n===q.a){
    score+=10; scoreEl.textContent=score;
  } else {
    lives--;
    livesEl.textContent=lives;
    water += 3; water=Math.min(water,100); waterEl.style.height=water+"%";
  }

  questionIndex++;

  if(questionIndex>=levels[levelIndex].length || lives===0){
    if(lives===0){
      splashText.textContent = `Level ${levelIndex+1} Failed!`;
      nextBtn.textContent = "Retry";
    } else {
      splashText.textContent = `Level ${levelIndex+1} Complete!`;
      nextBtn.textContent = "Next Level";
    }
    splash.style.display="flex";
    clearInterval(timerInterval);
    clearInterval(waterInterval);
    clearTimeout(platformDropTimeout);
    return;
  }

  jumpTo(questionIndex);
  load();
}

// ===== PLATFORM SHAKE & DROP
function schedulePlatformDrop() {
  clearTimeout(platformDropTimeout);

  platformDropTimeout = setTimeout(() => {
    platforms.forEach(p => p.classList.add("shake"));

    setTimeout(() => {
      platforms.forEach(p => {
        p.classList.remove("shake");
        p.classList.add("fall");
      });

      // Smooth puppy fall
      let startTop = parseFloat(puppy.style.top);
      let targetTop = 500;
      let t = 0;
      function animatePuppyFall() {
        t += 0.02;
        puppy.style.top = startTop + (targetTop - startTop) * t + "px";
        if(t<1) requestAnimationFrame(animatePuppyFall);
      }
      animatePuppyFall();

      setTimeout(() => {
        splashText.textContent = `Level ${levelIndex+1} Failed!`;
        nextBtn.textContent = "Retry";
        splash.style.display = "flex";
        clearInterval(timerInterval);
        clearInterval(waterInterval);
      }, 2000);

    }, 2000);

  }, 180000); // 3 minutes
}

// ===== START LEVEL
function startLevel(){
  splash.style.display="none";
  document.body.style.background=levelColors[levelIndex];
  water=5; waterEl.style.height=water+"%";
  seconds=0; questionIndex=0; lives=2; livesEl.textContent=lives;
  createPlatforms(levels[levelIndex].length);
  placePuppy(0);
  load();
  timerInterval=setInterval(updateTime,1000);
  waterInterval=setInterval(updateWater,5000);
  schedulePlatformDrop(); // schedule shake/drop
}

// ===== TIME / WATER
function updateTime(){ seconds++; document.getElementById("time").textContent=Math.floor(seconds/60)+":"+String(seconds%60).padStart(2,"0"); }
function updateWater(){ water+=0.5; water=Math.min(water,100); waterEl.style.height=water+"%"; }

// ===== NEXT LEVEL / RETRY
nextBtn.onclick = ()=>{
  splash.style.display="none";
  if(nextBtn.textContent==="Retry"){
    startLevel();
  } else {
    levelIndex++;
    if(levelIndex>=levels.length){ winDiv.style.display="flex"; return; }
    levelEl.textContent = levelIndex+1;
    startLevel();
  }
}

// ===== INIT
levelEl.textContent=levelIndex+1;
startLevel();
</script>

</body>
</html>
