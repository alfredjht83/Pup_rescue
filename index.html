<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puppy Rescue ‚Äì 3D Adventure</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif;}
body{overflow:hidden;transition:background 1s;}

/* HUD */
#hud{display:flex;justify-content:space-around;font-weight:bold;font-size:18px;margin-bottom:5px;}
#lives{color:red;font-weight:bold;}

/* GAME AREA */
#gameArea{
  position:relative;height:520px;width:100%;overflow:hidden;
  perspective:800px;
}

/* WATER */
#water{
  position:absolute;bottom:0;width:100%;height:5%;
  background:linear-gradient(rgba(2,136,209,0.8), rgba(1,87,155,0.8));
  transition:height 1s linear;
  z-index:1;
  border-top-left-radius:20px;
  border-top-right-radius:20px;
}
#water::before{
  content:""; position:absolute; width:200%; height:50%; left:-50%; top:0;
  background:radial-gradient(rgba(255,255,255,0.3) 15%, transparent 70%);
  background-size:50px 50px; animation:wave 4s linear infinite;
}
@keyframes wave{0%{background-position:0 0;}100%{background-position:50px 0;}}

/* PLATFORM 3D */
.platform{
  position:absolute;width:160px;height:20px;
  border-radius:12px;
  background:linear-gradient(#8bc34a,#558b2f);
  box-shadow:0 8px 0 #33691e,inset 0 3px rgba(255,255,255,.4);
  transform-style: preserve-3d;
  transition:top 0.8s ease, left 0.8s ease;
  z-index:2;
}
.platform::after{
  content:""; position:absolute; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.1); border-radius:12px;
}

/* SHAKE */
.shake{animation:shake .4s infinite;}
@keyframes shake{0%{transform:rotate(-1deg)}50%{transform:rotate(1deg)}100%{transform:rotate(-1deg)}}
.fall{top:600px!important;transition:top 2s linear;}

/* PUPPY */
#puppy{
  position:absolute; font-size:50px; z-index:3; text-align:center;
  transition:transform 0.2s;
  text-shadow: 2px 2px 2px rgba(0,0,0,0.3);
}

/* QUESTIONS */
#problem{text-align:center;font-size:17px;margin:8px;min-height:60px;padding:0 12px;}
#tiles{display:flex;justify-content:center;flex-wrap:wrap;}
.tile{
  width:95px;margin:6px;padding:10px;
  background:linear-gradient(#fff176,#fbc02d);
  border-radius:12px;
  box-shadow:0 6px #f57f17;
  font-weight:bold; cursor:pointer;
  text-align:center;
  transition:transform 0.1s, box-shadow 0.1s;
}
.tile:hover{transform:translateY(-3px); box-shadow:0 10px #f57f17;}
.tile:active{transform:translateY(4px); box-shadow:none;}

/* SPLASH / WIN SCREEN */
#splash, #win{
  position:absolute; inset:0; background:rgba(0,0,0,0.7);
  display:none; align-items:center; justify-content:center; flex-direction:column;
  color:white; font-size:30px; z-index:10;
}
#splash button, #win button{
  margin-top:20px;padding:10px 20px;font-size:18px;
  border:none;border-radius:10px;cursor:pointer;background:#ff9800;color:white;
}
</style>
</head>
<body>

<h1>üê∂ Puppy Rescue ‚Äì 3D Adventure</h1>

<div id="hud">
  <div>Level: <span id="level">1</span></div>
  <div>Score: <span id="score">0</span></div>
  <div>Lives: <span id="lives">2</span></div>
  <div>Time: <span id="time">0:00</span></div>
</div>

<div id="problem"></div>
<div id="gameArea">
  <div id="water"></div>
  <div id="puppy">üê∂</div>
</div>
<div id="tiles"></div>

<div id="splash">
  <div id="splash-text"></div>
  <button id="next-level">Next Level</button>
</div>

<div id="win">
  <div>üéâ Puppy rescued through all levels!</div>
</div>

<script>
// ================= GAME DATA =================
const levels = [

  // LEVEL 1 ‚Äì Subject-Verb Agreement & Tenses
  [
   {q:"Each of the players ______ given a certificate after the match.", a:"was", o:["were","was","are","have"]},
   {q:"The number of students in the hall ______ increasing every year.", a:"is", o:["are","were","is","be"]},
   {q:"She ______ her homework before she went out to play.", a:"had completed", o:["has completed","had completed","completed","completes"]},
   {q:"Neither John nor his friends ______ aware of the mistake.", a:"were", o:["was","were","is","be"]},
   {q:"By the time we arrived, the movie ______.", a:"had started", o:["has started","had started","was starting","starts"]}
  ],

  // LEVEL 2 ‚Äì Prepositions & Phrasal Verbs
  [
   {q:"The cat jumped ______ the table when it heard the noise.", a:"onto", o:["into","onto","over","between"]},
   {q:"She takes pride ______ her work.", a:"in", o:["on","in","at","with"]},
   {q:"The teacher told us to hand ______ our assignments by Friday.", a:"in", o:["out","over","in","up"]},
   {q:"He ran ______ an old friend at the supermarket.", a:"into", o:["across","over","into","through"]},
   {q:"We should not look ______ on others who need help.", a:"down", o:["up","down","into","for"]}
  ],

  // LEVEL 3 ‚Äì Vocabulary in Context (Common PSLE Themes)
  [
   {q:"The little boy was ______ when he realised he had lost his wallet.", a:"distressed", o:["distressed","delighted","relaxed","carefree"]},
   {q:"The firefighter remained ______ despite the dangerous situation.", a:"calm", o:["calm","careless","furious","selfish"]},
   {q:"Her ______ effort paid off when she won the competition.", a:"persistent", o:["lazy","persistent","careless","weak"]},
   {q:"The teacher gave a ______ glance at the noisy pupils.", a:"stern", o:["gentle","stern","joyful","sleepy"]},
   {q:"He was ______ enough to admit his mistake.", a:"brave", o:["brave","stubborn","greedy","jealous"]}
  ],

  // LEVEL 4 ‚Äì Word Forms (Noun / Verb / Adjective / Adverb)
  [
   {q:"She spoke ______ during the presentation.", a:"confidently", o:["confidence","confident","confidently","confidented"]},
   {q:"His ______ to help others earned him praise.", a:"willingness", o:["willing","willingly","willingness","will"]},
   {q:"The magician performed the trick with great ______.", a:"skill", o:["skilled","skill","skilful","skillfuly"]},
   {q:"The students listened ______ to the instructions.", a:"attentively", o:["attention","attentive","attentively","attentiveness"]},
   {q:"Her explanation was clear and ______.", a:"precise", o:["precision","precisely","precise","preciseness"]}
  ],

  // LEVEL 5 ‚Äì Editing Style (Common PSLE Error Types)
  [
   {q:"Everyone have brought their own lunch.", a:"has", o:["have","has","were","are"]},
   {q:"She prefers swimming than cycling.", a:"to", o:["than","to","with","over"]},
   {q:"The books on the shelf belongs to me.", a:"belong", o:["belongs","belong","belonged","belonging"]},
   {q:"He was too tired that he could not continue.", a:"so", o:["so","too","very","such"]},
   {q:"Despite of the heavy rain, the match continued.", a:"Despite", o:["Despite","Although","Because","Even"]}
  ]

];



// ------------------------ GAME LOGIC ------------------------
let levelIndex=0, questionIndex=0, score=0, water=5, seconds=0, lives=2;
const levelColors=["#87ceeb","#1e90ff","#8b4513","#ffc0cb","#E6CCFF"];

const puppy=document.getElementById("puppy");
const waterEl=document.getElementById("water");
const gameArea=document.getElementById("gameArea");
const problem=document.getElementById("problem");
const tiles=document.getElementById("tiles");
const scoreEl=document.getElementById("score");
const levelEl=document.getElementById("level");
const livesEl=document.getElementById("lives");
const splash=document.getElementById("splash");
const splashText=document.getElementById("splash-text");
const nextBtn=document.getElementById("next-level");
const winDiv=document.getElementById("win");

let platforms=[];
const baseY=400;
const gap=70;
let timerInterval, waterInterval, platformDropTimeout;

// ===== PLATFORM CREATION
function createPlatforms(num){
  platforms=[];
  document.querySelectorAll(".platform").forEach(p=>p.remove());
  for(let i=0;i<num;i++){
    const p=document.createElement("div");
    p.className="platform";
    let centerX = gameArea.offsetWidth/2;
    let offset = (i%2===0 ? -120 : 120);
    p.style.left = centerX + offset - 80 + "px";
    p.style.top = baseY - i*gap + "px";
    gameArea.appendChild(p);
    platforms.push(p);
  }
}

// ===== PUPPY POSITION
function placePuppy(i){
  const plat=platforms[i];
  puppy.style.left = (plat.offsetLeft + plat.offsetWidth/2 - 25) + "px";
  puppy.style.top = (plat.offsetTop - 50) + "px";
}

// ===== JUMP ANIMATION
function jumpTo(i){
  const startX=parseFloat(puppy.style.left);
  const startY=parseFloat(puppy.style.top);
  const endX = platforms[i].offsetLeft + platforms[i].offsetWidth/2 - 25;
  const endY = platforms[i].offsetTop - 50;
  let t=0;
  function animate(){
    t+=0.05;
    puppy.style.left = startX + (endX-startX)*t + "px";
    puppy.style.top = startY + (endY-startY)*t - Math.sin(t*Math.PI)*50 + "px";
    puppy.style.transform = `scale(${1 + 0.2*Math.sin(t*Math.PI)})`;
    if(t<1) requestAnimationFrame(animate);
  }
  animate();
}

// ===== LOAD QUESTION
function load(){
  const q=levels[levelIndex][questionIndex];
  problem.textContent=q.q;
  tiles.innerHTML="";
  q.o.sort(()=>Math.random()-0.5).forEach(n=>{
    const b=document.createElement("div");
    b.className="tile";
    b.textContent=n;
    b.onclick=()=>check(n);
    tiles.appendChild(b);
  });
}

// ===== CHECK ANSWER
function check(n){
  const q=levels[levelIndex][questionIndex];
  if(n===q.a){
    score+=10; scoreEl.textContent=score;
  } else {
    lives--;
    livesEl.textContent=lives;
    water += 3; water=Math.min(water,100); waterEl.style.height=water+"%";
  }

  questionIndex++;

  if(questionIndex>=levels[levelIndex].length || lives===0){
    if(lives===0){
      splashText.textContent = `Level ${levelIndex+1} Failed!`;
      nextBtn.textContent = "Retry";
    } else {
      splashText.textContent = `Level ${levelIndex+1} Complete!`;
      nextBtn.textContent = "Next Level";
    }
    splash.style.display="flex";
    clearInterval(timerInterval);
    clearInterval(waterInterval);
    clearTimeout(platformDropTimeout);
    return;
  }

  jumpTo(questionIndex);
  load();
}

// ===== PLATFORM SHAKE & DROP
function schedulePlatformDrop() {
  clearTimeout(platformDropTimeout);

  platformDropTimeout = setTimeout(() => {
    platforms.forEach(p => p.classList.add("shake"));

    setTimeout(() => {
      platforms.forEach(p => {
        p.classList.remove("shake");
        p.classList.add("fall");
      });

      // Smooth puppy fall
      let startTop = parseFloat(puppy.style.top);
      let targetTop = 500;
      let t = 0;
      function animatePuppyFall() {
        t += 0.02;
        puppy.style.top = startTop + (targetTop - startTop) * t + "px";
        if(t<1) requestAnimationFrame(animatePuppyFall);
      }
      animatePuppyFall();

      setTimeout(() => {
        splashText.textContent = `Level ${levelIndex+1} Failed!`;
        nextBtn.textContent = "Retry";
        splash.style.display = "flex";
        clearInterval(timerInterval);
        clearInterval(waterInterval);
      }, 2000);

    }, 2000);

  }, 180000); // 3 minutes
}

// ===== START LEVEL
function startLevel(){
  splash.style.display="none";
  document.body.style.background=levelColors[levelIndex];
  water=5; waterEl.style.height=water+"%";
  seconds=0; questionIndex=0; lives=2; livesEl.textContent=lives;
  createPlatforms(levels[levelIndex].length);
  placePuppy(0);
  load();
  timerInterval=setInterval(updateTime,1000);
  waterInterval=setInterval(updateWater,5000);
  schedulePlatformDrop(); // schedule shake/drop
}

// ===== TIME / WATER
function updateTime(){ seconds++; document.getElementById("time").textContent=Math.floor(seconds/60)+":"+String(seconds%60).padStart(2,"0"); }
function updateWater(){ water+=0.5; water=Math.min(water,100); waterEl.style.height=water+"%"; }

// ===== NEXT LEVEL / RETRY
nextBtn.onclick = ()=>{
  splash.style.display="none";
  if(nextBtn.textContent==="Retry"){
    startLevel();
  } else {
    levelIndex++;
    if(levelIndex>=levels.length){ winDiv.style.display="flex"; return; }
    levelEl.textContent = levelIndex+1;
    startLevel();
  }
}

// ===== INIT
levelEl.textContent=levelIndex+1;
startLevel();
</script>

</body>
</html>
