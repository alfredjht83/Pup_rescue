<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Puppy Rescue ‚Äì 3D Adventure</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif;}
body{overflow:hidden;transition:background 1s;}

/* HUD */
#hud{display:flex;justify-content:space-around;font-weight:bold;font-size:18px;margin-bottom:5px;}
#lives{color:red;font-weight:bold;}

/* GAME AREA */
#gameArea{
  position:relative;height:520px;width:100%;overflow:hidden;
  perspective:800px;
}

/* WATER */
#water{
  position:absolute;bottom:0;width:100%;height:5%;
  background:linear-gradient(rgba(2,136,209,0.8), rgba(1,87,155,0.8));
  transition:height 1s linear;
  z-index:1;
  border-top-left-radius:20px;
  border-top-right-radius:20px;
}
#water::before{
  content:""; position:absolute; width:200%; height:50%; left:-50%; top:0;
  background:radial-gradient(rgba(255,255,255,0.3) 15%, transparent 70%);
  background-size:50px 50px; animation:wave 4s linear infinite;
}
@keyframes wave{0%{background-position:0 0;}100%{background-position:50px 0;}}

/* PLATFORM 3D */
.platform{
  position:absolute;width:160px;height:20px;
  border-radius:12px;
  background:linear-gradient(#8bc34a,#558b2f);
  box-shadow:0 8px 0 #33691e,inset 0 3px rgba(255,255,255,.4);
  transform-style: preserve-3d;
  transition:top 0.8s ease, left 0.8s ease;
  z-index:2;
}
.platform::after{
  content:""; position:absolute; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.1); border-radius:12px;
}

/* SHAKE */
.shake{animation:shake .4s infinite;}
@keyframes shake{0%{transform:rotate(-1deg)}50%{transform:rotate(1deg)}100%{transform:rotate(-1deg)}}
.fall{top:600px!important;transition:top 2s linear;}

/* PUPPY */
#puppy{
  position:absolute; font-size:50px; z-index:3; text-align:center;
  transition:transform 0.2s;
  text-shadow: 2px 2px 2px rgba(0,0,0,0.3);
}

/* QUESTIONS */
#problem{text-align:center;font-size:17px;margin:8px;min-height:60px;padding:0 12px;}
#tiles{display:flex;justify-content:center;flex-wrap:wrap;}
.tile{
  width:95px;margin:6px;padding:10px;
  background:linear-gradient(#fff176,#fbc02d);
  border-radius:12px;
  box-shadow:0 6px #f57f17;
  font-weight:bold; cursor:pointer;
  text-align:center;
  transition:transform 0.1s, box-shadow 0.1s;
}
.tile:hover{transform:translateY(-3px); box-shadow:0 10px #f57f17;}
.tile:active{transform:translateY(4px); box-shadow:none;}

/* SPLASH / WIN SCREEN */
#splash, #win{
  position:absolute; inset:0; background:rgba(0,0,0,0.7);
  display:none; align-items:center; justify-content:center; flex-direction:column;
  color:white; font-size:30px; z-index:10;
}
#splash button, #win button{
  margin-top:20px;padding:10px 20px;font-size:18px;
  border:none;border-radius:10px;cursor:pointer;background:#ff9800;color:white;
}
</style>
</head>
<body>

<h1>üê∂ Puppy Rescue ‚Äì 3D Adventure</h1>

<div id="hud">
  <div>Level: <span id="level">1</span></div>
  <div>Score: <span id="score">0</span></div>
  <div>Lives: <span id="lives">2</span></div>
  <div>Time: <span id="time">0:00</span></div>
</div>

<div id="problem"></div>
<div id="gameArea">
  <div id="water"></div>
  <div id="puppy">üê∂</div>
</div>
<div id="tiles"></div>

<div id="splash">
  <div id="splash-text"></div>
  <button id="next-level">Next Level</button>
</div>

<div id="win">
  <div>üéâ Puppy rescued through all levels!</div>
</div>

<script>
// ================= GAME DATA =================
const levels = [

  // LEVEL 1 ‚Äì Basic Fractions & Percentage
  [
   {q:"3/5 of 80 = ?", a:48, o:[40,48,50,60]},
   {q:"25% of 240 = ?", a:60, o:[40,50,60,80]},
   {q:"A number is increased by 20%. If the original number is 150, what is the new number?", a:180, o:[160,170,180,190]},
   {q:"What is 7/8 written as a decimal?", a:0.875, o:[0.785,0.875,0.807,0.978]},
   {q:"If 6 pencils cost $3.60, how much does 1 pencil cost?", a:0.6, o:[0.5,0.6,0.7,0.8]}
  ],

  // LEVEL 2 ‚Äì Ratio & Fraction of Remainder
  [
   {q:"The ratio of boys to girls is 3 : 5. If there are 24 boys, how many girls are there?", a:40, o:[32,36,40,48]},
   {q:"Ali spent 2/7 of his money and had $35 left. How much did he have at first?", a:49, o:[42,49,56,63]},
   {q:"The ratio of red beads to blue beads is 4 : 9. There are 45 more blue beads than red beads. How many red beads are there?", a:36, o:[27,36,45,54]},
   {q:"After giving away 3/8 of her stickers, Mary had 25 left. How many stickers did she have at first?", a:40, o:[32,36,40,48]},
   {q:"The ratio of Tom‚Äôs money to Jim‚Äôs money is 5 : 6. If Tom has $150, how much do they have altogether?", a:330, o:[300,330,360,390]}
  ],

  // LEVEL 3 ‚Äì Geometry (Area, Perimeter, Angles)
  [
   {q:"A rectangle is 15 cm long and 9 cm wide. What is its area?", a:135, o:[108,120,135,150]},
   {q:"The perimeter of a square is 48 cm. What is its area?", a:144, o:[121,144,169,196]},
   {q:"One interior angle of a regular pentagon is?", a:108, o:[90,108,120,135]},
   {q:"A triangle has angles 35¬∞, 65¬∞ and ______.", a:80, o:[70,75,80,85]},
   {q:"The area of a rectangle is 120 cm¬≤. If its length is 15 cm, what is its width?", a:8, o:[6,7,8,10]}
  ],

  // LEVEL 4 ‚Äì Speed, Average & Volume
  [
   {q:"A car travels 180 km in 3 hours. What is its speed?", a:60, o:[50,55,60,65]},
   {q:"A train travels at 80 km/h for 2.5 hours. What distance does it cover?", a:200, o:[160,180,200,220]},
   {q:"The average of 6 numbers is 18. What is the total of the numbers?", a:108, o:[96,102,108,120]},
   {q:"A rectangular tank measures 5 m by 3 m by 2 m. What is its volume?", a:30, o:[20,25,30,40]},
   {q:"A boy walked 4 km at 5 km/h. How long did he take?", a:0.8, o:[0.6,0.8,1,1.2]}
  ],

  // LEVEL 5 ‚Äì Higher Order Thinking (2‚Äì3 Steps)
  [
   {q:"The ratio of A to B is 2 : 3. After A gives B 10 marbles, the ratio becomes 1 : 2. How many marbles did A have at first?", a:40, o:[30,40,50,60]},
   {q:"A number is decreased by 15% to become 170. What was the original number?", a:200, o:[180,190,200,210]},
   {q:"The ratio of boys to girls is 4 : 5. After 6 boys leave, the ratio becomes 2 : 3. How many pupils were there at first?", a:90, o:[72,90,108,120]},
   {q:"A shop increases the price of a bag by 20% and then gives a 20% discount. If the original price was $100, what is the final price?", a:96, o:[90,96,100,104]},
   {q:"Peter spent 3/5 of his money. After receiving $40, he had $100. How much did he have at first?", a:150, o:[120,140,150,160]}
  ]

];


// ------------------------ GAME LOGIC ------------------------
let levelIndex=0, questionIndex=0, score=0, water=5, seconds=0, lives=2;
const levelColors=["#87ceeb","#1e90ff","#8b4513","#ffc0cb","#E6CCFF"];

const puppy=document.getElementById("puppy");
const waterEl=document.getElementById("water");
const gameArea=document.getElementById("gameArea");
const problem=document.getElementById("problem");
const tiles=document.getElementById("tiles");
const scoreEl=document.getElementById("score");
const levelEl=document.getElementById("level");
const livesEl=document.getElementById("lives");
const splash=document.getElementById("splash");
const splashText=document.getElementById("splash-text");
const nextBtn=document.getElementById("next-level");
const winDiv=document.getElementById("win");

let platforms=[];
const baseY=400;
const gap=70;
let timerInterval, waterInterval, platformDropTimeout;

// ===== PLATFORM CREATION
function createPlatforms(num){
  platforms=[];
  document.querySelectorAll(".platform").forEach(p=>p.remove());
  for(let i=0;i<num;i++){
    const p=document.createElement("div");
    p.className="platform";
    let centerX = gameArea.offsetWidth/2;
    let offset = (i%2===0 ? -120 : 120);
    p.style.left = centerX + offset - 80 + "px";
    p.style.top = baseY - i*gap + "px";
    gameArea.appendChild(p);
    platforms.push(p);
  }
}

// ===== PUPPY POSITION
function placePuppy(i){
  const plat=platforms[i];
  puppy.style.left = (plat.offsetLeft + plat.offsetWidth/2 - 25) + "px";
  puppy.style.top = (plat.offsetTop - 50) + "px";
}

// ===== JUMP ANIMATION
function jumpTo(i){
  const startX=parseFloat(puppy.style.left);
  const startY=parseFloat(puppy.style.top);
  const endX = platforms[i].offsetLeft + platforms[i].offsetWidth/2 - 25;
  const endY = platforms[i].offsetTop - 50;
  let t=0;
  function animate(){
    t+=0.05;
    puppy.style.left = startX + (endX-startX)*t + "px";
    puppy.style.top = startY + (endY-startY)*t - Math.sin(t*Math.PI)*50 + "px";
    puppy.style.transform = `scale(${1 + 0.2*Math.sin(t*Math.PI)})`;
    if(t<1) requestAnimationFrame(animate);
  }
  animate();
}

// ===== LOAD QUESTION
function load(){
  const q=levels[levelIndex][questionIndex];
  problem.textContent=q.q;
  tiles.innerHTML="";
  q.o.sort(()=>Math.random()-0.5).forEach(n=>{
    const b=document.createElement("div");
    b.className="tile";
    b.textContent=n;
    b.onclick=()=>check(n);
    tiles.appendChild(b);
  });
}

// ===== CHECK ANSWER
function check(n){
  const q=levels[levelIndex][questionIndex];
  if(n===q.a){
    score+=10; scoreEl.textContent=score;
  } else {
    lives--;
    livesEl.textContent=lives;
    water += 3; water=Math.min(water,100); waterEl.style.height=water+"%";
  }

  questionIndex++;

  if(questionIndex>=levels[levelIndex].length || lives===0){
    if(lives===0){
      splashText.textContent = `Level ${levelIndex+1} Failed!`;
      nextBtn.textContent = "Retry";
    } else {
      splashText.textContent = `Level ${levelIndex+1} Complete!`;
      nextBtn.textContent = "Next Level";
    }
    splash.style.display="flex";
    clearInterval(timerInterval);
    clearInterval(waterInterval);
    clearTimeout(platformDropTimeout);
    return;
  }

  jumpTo(questionIndex);
  load();
}

// ===== PLATFORM SHAKE & DROP
function schedulePlatformDrop() {
  clearTimeout(platformDropTimeout);

  platformDropTimeout = setTimeout(() => {
    platforms.forEach(p => p.classList.add("shake"));

    setTimeout(() => {
      platforms.forEach(p => {
        p.classList.remove("shake");
        p.classList.add("fall");
      });

      // Smooth puppy fall
      let startTop = parseFloat(puppy.style.top);
      let targetTop = 500;
      let t = 0;
      function animatePuppyFall() {
        t += 0.02;
        puppy.style.top = startTop + (targetTop - startTop) * t + "px";
        if(t<1) requestAnimationFrame(animatePuppyFall);
      }
      animatePuppyFall();

      setTimeout(() => {
        splashText.textContent = `Level ${levelIndex+1} Failed!`;
        nextBtn.textContent = "Retry";
        splash.style.display = "flex";
        clearInterval(timerInterval);
        clearInterval(waterInterval);
      }, 2000);

    }, 2000);

  }, 180000); // 3 minutes
}

// ===== START LEVEL
function startLevel(){
  splash.style.display="none";
  document.body.style.background=levelColors[levelIndex];
  water=5; waterEl.style.height=water+"%";
  seconds=0; questionIndex=0; lives=2; livesEl.textContent=lives;
  createPlatforms(levels[levelIndex].length);
  placePuppy(0);
  load();
  timerInterval=setInterval(updateTime,1000);
  waterInterval=setInterval(updateWater,5000);
  schedulePlatformDrop(); // schedule shake/drop
}

// ===== TIME / WATER
function updateTime(){ seconds++; document.getElementById("time").textContent=Math.floor(seconds/60)+":"+String(seconds%60).padStart(2,"0"); }
function updateWater(){ water+=0.5; water=Math.min(water,100); waterEl.style.height=water+"%"; }

// ===== NEXT LEVEL / RETRY
nextBtn.onclick = ()=>{
  splash.style.display="none";
  if(nextBtn.textContent==="Retry"){
    startLevel();
  } else {
    levelIndex++;
    if(levelIndex>=levels.length){ winDiv.style.display="flex"; return; }
    levelEl.textContent = levelIndex+1;
    startLevel();
  }
}

// ===== INIT
levelEl.textContent=levelIndex+1;
startLevel();
</script>

</body>
</html>
